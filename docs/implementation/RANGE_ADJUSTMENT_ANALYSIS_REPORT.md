# PTQ ë²”ìœ„ ì¡°ì ˆ ë¶„ì„ ë³´ê³ ì„œ

## ê°œìš”

Dual-Head ì•„í‚¤í…ì²˜ì—ì„œ **max_depthì™€ min_depthë¥¼ ì¡°ì ˆí–ˆì„ ë•Œ**, ì‹¤ì œ í•™ìŠµ ì½”ë“œì—ì„œ ì–´ë–»ê²Œ ê³„ì‚°ë˜ëŠ”ì§€ ìˆ˜ì¹˜ ë¶„ì„í•œ ë³´ê³ ì„œì…ë‹ˆë‹¤.

### ë¶„ì„ ë²”ìœ„
- **5ê°€ì§€ ì„¤ì • ë¹„êµ**: 5m, 15m (ê¸°ë³¸), 30m, 50m, 80m
- **6ê°€ì§€ í…ŒìŠ¤íŠ¸ ê¹Šì´**: ìµœì†Œê°’, ì¤‘ê°„ê°’, 50%, 75%, 90%, ìµœëŒ€ê°’
- **ë‘ ê°€ì§€ ë‹¨ê³„**: í•™ìŠµ ë‹¨ê³„(Training) vs PTQ ì–‘ìí™” ë‹¨ê³„(Deployment)

---

## 1. í•µì‹¬ ë°œê²¬ì‚¬í•­

### 1.1 Integer ì–‘ìí™” ê°„ê²©ì˜ ì˜ì¡´ì„±

| Max Depth | Integer ê°„ê²© | Fractional ê°„ê²© | ë¹„ìœ¨ |
|-----------|-------------|-----------------|------|
| 5m        | **19.61mm** | 3.92mm         | 5.0Ã— |
| 15m       | **58.82mm** | 3.92mm         | 15.0Ã— |
| 30m       | **117.65mm** | 3.92mm        | 30.0Ã— |
| 50m       | **196.08mm** | 3.92mm        | 50.0Ã— |
| 80m       | **313.73mm** | 3.92mm        | 80.0Ã— |

**ê²°ë¡ **: Integer ê°„ê²© = **max_depth / 255**
- max_depthê°€ ì¦ê°€ â†’ ì •ë°€ë„ ê°ì†Œ
- Fractional ê°„ê²©ì€ **í•­ìƒ 3.92mm ê³ ì •**

### 1.2 ì •ë°€ë„ ì£¼ë„ê¶Œ ë³€í™”

```
Short Range (5m):
  â”œâ”€ Integer ê°„ê²©:    19.61mm
  â”œâ”€ Fractional ê°„ê²©: 3.92mm
  â””â”€ ì£¼ë„:            Fractional âœ“

Original (15m):
  â”œâ”€ Integer ê°„ê²©:    58.82mm
  â”œâ”€ Fractional ê°„ê²©: 3.92mm
  â””â”€ ì£¼ë„:            Fractional (ì—¬ì „íˆ)

Long Range (30m+):
  â”œâ”€ Integer ê°„ê²©:    117.65mm+
  â”œâ”€ Fractional ê°„ê²©: 3.92mm
  â””â”€ ì£¼ë„:            Integer âœ—
  â””â”€ ë¬¸ì œ:            Fractionalì´ ë¬´ì˜ë¯¸í•´ì§
```

---

## 2. ìƒì„¸ ìˆ˜ì¹˜ ë¶„ì„

### 2.1 Short Range (5m) - ê·¼ê±°ë¦¬ ì„¤ì •

```
ëª©í‘œ: ì‹¤ë‚´, ë“œë¡  ë“± ê·¼ê±°ë¦¬ ì¸¡ì •
ì„¤ì •: max_depth=5m, min_depth=0.1m

í…ŒìŠ¤íŠ¸ ê¹Šì´ 5.0mì—ì„œ:

í•™ìŠµ ë‹¨ê³„ (Float32):
  Integer:   floor(5.0) / 5.0 = 1.0 (ì •ê·œí™”)
  Fractional: 5.0 - 5.0 = 0.0
  ì¬êµ¬ì„±:     1.0*5 + 0.0 = 5.0m âœ“ (ì™„ë²½)

PTQ ë‹¨ê³„ (Int8 ë°°í¬):
  Integer ë ˆë²¨:   round(5.0 / 5.0 * 255) = 255
  Integer ê¹Šì´:   (255/255) * 5.0 = 5.0m âœ“
  Fractional:     0.0 * 1.0 = 0.0m
  ìµœì¢… ê¹Šì´:      5.0m âœ“ (ì™„ë²½)

ì–‘ìí™” íš¨ê³¼: ê±°ì˜ ì—†ìŒ (ì •ë°€ë„ ì†ì‹¤ < 10mm)
```

**ì´ ì„¤ì •ì˜ íŠ¹ì„±:**
- âœ… ë§¤ìš° ë†’ì€ ì •ë°€ë„ (~4mm)
- âœ… PTQ ì†ì‹¤ ìµœì†Œ
- âœ— 5m ì´ìƒ ì¸¡ì • ë¶ˆê°€ëŠ¥
- ğŸ“± ìš©ë„: ì‹¤ë‚´ ì¸¡ì •, ê·¼ê±°ë¦¬ ë¬¼ì²´

### 2.2 Original (15m) - ê¸°ë³¸ ì„¤ì •

```
ëª©í‘œ: ììœ¨ì£¼í–‰(KITTI) í‘œì¤€ ë²”ìœ„
ì„¤ì •: max_depth=15m, min_depth=0.5m

í…ŒìŠ¤íŠ¸ ê¹Šì´ 5.0mì—ì„œ:

í•™ìŠµ ë‹¨ê³„ (Float32):
  Integer:   floor(5.0) / 15.0 = 0.333
  Fractional: 5.0 - 5.0 = 0.0
  ì¬êµ¬ì„±:     0.333*15 + 0.0 = 5.0m âœ“

PTQ ë‹¨ê³„ (Int8 ë°°í¬):
  Integer ë ˆë²¨:   round(5.0 / 15.0 * 255) = round(85) = 85
  Integer ê¹Šì´:   (85/255) * 15.0 = 5.0m âœ“
  Fractional:     0.0 * 1.0 = 0.0m
  ìµœì¢… ê¹Šì´:      5.0m âœ“

PTQ ì˜¤ì°¨:
  ìµœì•… ì¼€ì´ìŠ¤: Â±58.82mm (Integer ê²½ê³„)
  í‰ê· :       ~12mm

ì–‘ìí™” íš¨ê³¼: ì¤‘ê°„ ìˆ˜ì¤€ (ì •ë°€ë„ ì†ì‹¤ ~ 30mm)
```

**í…Œì´ë¸”: 15m ì„¤ì •ì—ì„œ ë‹¤ì–‘í•œ ê¹Šì´ë³„ ì˜¤ì°¨**

| ê¹Šì´ (m) | Train ì •ìˆ˜ë¶€ | PTQ Int ë ˆë²¨ | Frac (mm) | Train ì˜¤ì°¨ | PTQ ì˜¤ì°¨ |
|---------|-------------|-----------|----------|----------|---------|
| 0.5     | 0.0000      | 8         | 29.41    | 0.0mm    | 0.0mm   |
| 7.75    | 0.4667      | 132       | 0.00     | 0.0mm    | **14.7mm** |
| 7.5     | 0.4667      | 128       | 0.00     | 0.0mm    | **29.4mm** |
| 11.25   | 0.7333      | 191       | 14.71    | 0.0mm    | 0.0mm   |
| 13.5    | 0.8667      | 230       | 0.00     | 0.0mm    | **29.4mm** |
| 15.0    | 1.0000      | 255       | 0.00     | 0.0mm    | 0.0mm   |

**ê´€ì°°:**
- Integer ë ˆë²¨ì´ ê²½ê³„(8â†’9, 128â†’129 ë“±)ì— ìˆì„ ë•Œ ìµœëŒ€ ì˜¤ì°¨
- Fractionalì´ ë³´ì •í•˜ì§€ë§Œ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ
- í‰ê·  ì˜¤ì°¨: 12.26mm

### 2.3 Long Range (30m) - ì¥ê±°ë¦¬ ì„¤ì •

```
ëª©í‘œ: ì•¼ì™¸ ì‹¤ì œ ê±°ë¦¬ ì¸¡ì • í•„ìš” ì‹œ
ì„¤ì •: max_depth=30m, min_depth=0.5m

í…ŒìŠ¤íŠ¸ ê¹Šì´ 5.0mì—ì„œ:

í•™ìŠµ ë‹¨ê³„ (Float32):
  Integer:   floor(5.0) / 30.0 = 0.167
  Fractional: 5.0 - 5.0 = 0.0
  ì¬êµ¬ì„±:     0.167*30 + 0.0 = 5.0m âœ“

PTQ ë‹¨ê³„ (Int8 ë°°í¬):
  Integer ë ˆë²¨:   round(5.0 / 30.0 * 255) = round(42.5) = 43 ë˜ëŠ” 42
  
  Case 1 (ë ˆë²¨ 43):
    Integer ê¹Šì´:   (43/255) * 30.0 = 5.04m
    ìµœì¢… ê¹Šì´:      5.04m Â± 58.8mm (ì˜¤ì°¨ ë²”ìœ„)
  
  Case 2 (ë ˆë²¨ 42):
    Integer ê¹Šì´:   (42/255) * 30.0 = 4.94m
    ìµœì¢… ê¹Šì´:      4.94m Â± 58.8mm (ì˜¤ì°¨ ë²”ìœ„)

PTQ ì˜¤ì°¨: ìµœì•… Â±58.82mm, í‰ê·  27mm

ì–‘ìí™” íš¨ê³¼: ìƒë‹¹í•¨ (ì •ë°€ë„ ì†ì‹¤ ~ 60mm)
```

**í…Œì´ë¸”: 30m ì„¤ì •ì—ì„œ ë‹¤ì–‘í•œ ê¹Šì´ë³„ ì˜¤ì°¨**

| ê¹Šì´ (m) | Train ì •ìˆ˜ë¶€ | PTQ Int ë ˆë²¨ | Frac (mm) | Train ì˜¤ì°¨ | PTQ ì˜¤ì°¨ |
|---------|-------------|-----------|----------|----------|---------|
| 0.5     | 0.0000      | 4         | 29.41    | 0.0mm    | 0.0mm   |
| 15.25   | 0.5000      | 130       | 0.00     | 0.0mm    | **44.1mm** |
| 15.0    | 0.5000      | 128       | 0.00     | 0.0mm    | **58.8mm** |
| 22.5    | 0.7333      | 191       | 29.41    | 0.0mm    | 0.0mm   |
| 27.0    | 0.9000      | 230       | 0.00     | 0.0mm    | **58.8mm** |
| 30.0    | 1.0000      | 255       | 0.00     | 0.0mm    | 0.0mm   |

**ë¬¸ì œì :**
- Integer ë ˆë²¨ì´ ë” ì„±ê¸€ì–´ì§ (30/255 â‰ˆ 0.118)
- Fractionalì˜ 3.92mmëŠ” ë¬´ì˜ë¯¸ (Integerê°€ Â±60mm ì˜¤ì°¨)
- Fractional ê°€ì¤‘ì¹˜ë¥¼ ë†’ì—¬ë„ ê°œì„  ì œí•œì 

### 2.4 Very Long Range (80m) - ê·¹ì¥ê±°ë¦¬ ì„¤ì •

```
ëª©í‘œ: ì¥ê±°ë¦¬ LiDAR ìˆ˜ì¤€
ì„¤ì •: max_depth=80m, min_depth=0.5m

íŠ¹ì§•:
  Integer ê°„ê²©: 313.73mm (!!)
  Fractional ê°„ê²©: 3.92mm (ë¬´ì‹œ)
  
ê²°ê³¼:
  ìµœì•… ì •ë°€ë„: Â±156.86mm
  í‰ê·  ì •ë°€ë„: 73.53mm
  
ë¬¸ì œ: Integerê°€ ë„ˆë¬´ ê±°ì¹ ì–´ì„œ Fractionalì´ ì˜ë¯¸ ì—†ìŒ
```

**ê²°ë¡ : 80mì€ ë„ˆë¬´ ê¸º!**

---

## 3. í•™ìŠµ ë‹¨ê³„ vs PTQ ë‹¨ê³„ ë¹„êµ

### 3.1 í•µì‹¬ ì°¨ì´ì 

**í•™ìŠµ ë‹¨ê³„ (Float32)**
```python
integer_gt = floor(depth_gt) / max_depth
fractional_gt = depth_gt - floor(depth_gt)
```

ì¥ì :
- ì •í™•í•œ ë¶„í•´ (ì†ì‹¤ ì—†ìŒ)
- ëª¨ë“  ê¹Šì´ ê°’ í‘œí˜„ ê°€ëŠ¥ (ì—°ì†)

**PTQ ë‹¨ê³„ (Int8)**
```python
integer_level = round((depth_gt / max_depth) * 255)
integer_gt_quantized = integer_level / 255
fractional_gt = depth_gt - (integer_gt_quantized * max_depth)
```

íŠ¹ì§•:
- 256ê°œ discrete levelë§Œ ê°€ëŠ¥
- ì–‘ìí™” ì˜¤ì°¨ ë°œìƒ
- NPU/INT8 ì¹œí™”ì 

### 3.2 ì˜¤ì°¨ ë¶„í¬

| ì„¤ì • | Train í‰ê·  ì˜¤ì°¨ | PTQ í‰ê·  ì˜¤ì°¨ | ì¦ê°€ìœ¨ | PTQ ìµœì•… ì˜¤ì°¨ |
|------|---------------|-------------|-------|------------|
| 5m   | 0.00mm        | **3.27mm**  | âˆ     | 9.80mm    |
| 15m  | 0.00mm        | **12.26mm** | âˆ     | 29.41mm   |
| 30m  | 0.00mm        | **26.96mm** | âˆ     | 58.82mm   |
| 50m  | 0.00mm        | **48.04mm** | âˆ     | 98.04mm   |
| 80m  | 0.00mm        | **73.53mm** | âˆ     | 156.86mm  |

**íŒ¨í„´:**
- í•™ìŠµì€ ì™„ë²½ (floor ê¸°ë°˜)
- PTQëŠ” ì–‘ìí™”ë¡œ ì¸í•œ ì˜¤ì°¨ ë°œìƒ
- max_depthì— ë¹„ë¡€í•˜ì—¬ ì˜¤ì°¨ ì¦ê°€

---

## 4. ìµœì  ì„¤ì • ì„ íƒ ê°€ì´ë“œ

### 4.1 ìš©ë„ë³„ ì¶”ì²œ

#### ğŸ“± ì‹¤ë‚´ / ê·¼ê±°ë¦¬ (VR, ë“œë¡ , ë¡œë´‡)
```
ì„¤ì •: max_depth=5m, min_depth=0.1m
íŠ¹ì„±:
  âœ“ ì •ë°€ë„: ~4mm (Fractional ì£¼ë„)
  âœ“ PTQ ì†ì‹¤: 3mm ì •ë„ (ë¬´ì‹œí•  ìˆ˜ì¤€)
  âœ— ë²”ìœ„: 5mê¹Œì§€ë§Œ

ê°€ì¤‘ì¹˜ ì¶”ì²œ:
  integer_weight: 1.0
  fractional_weight: 10.0 (ì •ë°€ë„ ì¤‘ìš”)
```

#### ğŸš— ììœ¨ì£¼í–‰ KITTI í‘œì¤€
```
ì„¤ì •: max_depth=80m, min_depth=0.5m
íŠ¹ì„±:
  âœ“ ë²”ìœ„: 80mê¹Œì§€ ì¸¡ì • ê°€ëŠ¥
  âœ— ì •ë°€ë„: ~314mm (Integer ì£¼ë„)
  âœ— PTQ ì†ì‹¤: 73mm í‰ê· 
  âš ï¸ ë¬¸ì œ: Fractionalì´ ê±°ì˜ ë¬´ì˜ë¯¸

í˜„ì¬ ì½”ë“œ: max_depth=15mì´ ë” ë‚˜ìŒ!
```

#### ğŸ¢ ì¤‘ê°„ê±°ë¦¬ (ë³´ì•ˆì¹´ë©”ë¼, ì¼ë°˜ ì‹¤ì™¸)
```
ì„¤ì •: max_depth=30m, min_depth=0.3m
íŠ¹ì„±:
  âœ“ ë²”ìœ„: 30m (ì¶©ë¶„)
  âœ“ ì •ë°€ë„: ~118mm (ì‚¬ìš© ê°€ëŠ¥)
  âœ“ PTQ ì†ì‹¤: 27mm (ì¤‘ê°„)

ê°€ì¤‘ì¹˜ ì¶”ì²œ:
  integer_weight: 1.0
  fractional_weight: 15.0+ (Integerë¥¼ ë³´ì •í•˜ê¸° ìœ„í•´)
```

### 4.2 Fractional ê°€ì¤‘ì¹˜ ì¡°ì ˆ ì „ëµ

```
max_depth ë³„ ê¶Œì¥ Fractional ê°€ì¤‘ì¹˜:

5m:   weight = 10.0   (Integer ê°„ê²© 19.6mm)
15m:  weight = 10.0 ~ 15.0 (Integer ê°„ê²© 58.8mm)
30m:  weight = 15.0 ~ 20.0 (Integer ê°„ê²© 117.6mm)
50m:  weight = 20.0 ~ 30.0 (Integer ê°„ê²© 196mm)
80m:  weight = 30.0+ (Integer ê°„ê²© 313.7mm - ë„ì›€ ì œí•œì )

ì¼ë°˜ì  ê·œì¹™:
  fractional_weight = max_depth
```

---

## 5. PTQ ë°°í¬ ì‹œ ê³ ë ¤ì‚¬í•­

### 5.1 ê° ì„¤ì •ì˜ Int8 ì–‘ìí™” íš¨ê³¼

```python
# ë°°í¬ ì‹œ ê° í—¤ë“œë¥¼ 8-bitìœ¼ë¡œ ì–‘ìí™”

def quantize_depth_heads(integer_out, fractional_out, max_depth):
    """
    Float32 ëª¨ë¸ì˜ ì¶œë ¥ì„ Int8ë¡œ ì–‘ìí™”
    
    Args:
        integer_out: [0, 1] sigmoid output
        fractional_out: [0, 1] sigmoid output
        max_depth: ì‚¬ìš©ëœ max_depth ê°’
    """
    
    # Integer head: [0, 1] â†’ 8-bit [0, 255]
    # Scale: max_depth â†’ 255
    integer_quant = integer_out * 255  # 8-bit value
    integer_depth = (integer_quant / 255) * max_depth
    
    # Fractional head: [0, 1]m â†’ 8-bit [0, 255]
    # Scale: 1000mm â†’ 255
    fractional_quant = fractional_out * 255  # 8-bit value
    fractional_depth = (fractional_quant / 255) * 1000  # mm
    
    final_depth = integer_depth + (fractional_depth / 1000)
    
    return final_depth
```

### 5.2 ì„¤ì •ë³„ ì–‘ìí™” ì†ì‹¤

| ì„¤ì • | Integer ê°„ê²© | Fractional ê°€ëŠ¥ ë³´ì • | ì´ìƒì  ì •ë°€ë„ |
|------|-------------|------------------|------------|
| 5m   | 19.6mm     | O (Â±3.92mm)      | ~4mm      |
| 15m  | 58.8mm     | â–³ (Â±3.92mm)      | ~15mm     |
| 30m  | 117.6mm    | X (Â±3.92mm ë¬´ì˜ë¯¸) | ~60mm    |
| 80m  | 313.7mm    | X (ê±°ì˜ ë¶ˆê°€ëŠ¥)   | ~157mm   |

---

## 6. í˜„ì¬ ì½”ë“œì˜ ìµœì ì„± í‰ê°€

### 6.1 í˜„ì¬ ì„¤ì • ë¶„ì„ (max_depth=15m)

```
ì¥ì :
âœ“ Integer ê°„ê²©: 58.8mm (ì‚¬ìš© ê°€ëŠ¥)
âœ“ Fractionalê³¼ ê· í˜•: 58.8mm / 3.92mm = 15ë°°
âœ“ ë²”ìœ„: 0~15m (KITTI í‘œì¤€)
âœ“ Fractional ê°€ì¤‘ì¹˜ 10.0ì´ íš¨ê³¼ì 

ë‹¨ì :
âœ— NCDB ë“± ë” ë¨¼ ê±°ë¦¬ í•„ìš” ì‹œ ë¶€ì¡±
```

### 6.2 ë³€ê²½ í•„ìš” ì‹œ ì•ˆì „ ë²”ìœ„

```
ê¶Œì¥ ë²”ìœ„:
  5m â‰¤ max_depth â‰¤ 30m
  
ë³€ê²½ ì‹œ í•„ìˆ˜:
  âœ“ Fractional ê°€ì¤‘ì¹˜ ì¡°ì ˆ
  âœ“ í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰
  âœ“ ì •ë°€ë„ ê²€ì¦

ì ˆëŒ€ ê¸ˆì§€:
  âœ— max_depth > 80m (Integer ë„ˆë¬´ ê±°ì¹¨)
```

---

## 7. ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### 7.1 í•µì‹¬ ì¸ì‚¬ì´íŠ¸

```
1ï¸âƒ£ Integer ì–‘ìí™”ê°€ ì •ë°€ë„ë¥¼ ê²°ì •í•œë‹¤
   - Fractional (3.92mm)ëŠ” Integer (19.6 ~ 313.7mm)ì— ë¹„í•´ ë¬´ì‹œí•  ìˆ˜ì¤€
   
2ï¸âƒ£ Fractional ê°€ì¤‘ì¹˜ëŠ” Integerë¥¼ ë³´ì •í•˜ê¸° ìœ„í•œ ê²ƒ
   - ì •ë°€ë„ ë¶€ì¡±ì„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë³´ì™„ (ì˜ˆ: í‰í™œí™”, ë‹¤ì¤‘ ì˜ˆì¸¡)
   - ì§ì ‘ì ìœ¼ë¡œ ì •ë°€ë„ë¥¼ í¬ê²Œ í–¥ìƒì‹œí‚¤ì§€ëŠ” ì•ŠìŒ
   
3ï¸âƒ£ max_depth ì„ íƒì´ ê°€ì¥ ì¤‘ìš”í•œ ì„¤ê³„ ê²°ì •
   - ë„ˆë¬´ ê¸¸ë©´ Integer ê±°ì¹ ì–´ì§
   - ë„ˆë¬´ ì§§ìœ¼ë©´ ë²”ìœ„ ë¶€ì¡±
```

### 7.2 ìµœì¢… ê¶Œì¥ ì„¤ì •

**í˜„ì¬ ì½”ë“œ (KITTI, NCDB):**
```yaml
max_depth: 15.0  # í˜„ì¬ê°’
min_depth: 0.5
integer_weight: 1.0
fractional_weight: 10.0  # í˜„ì¬ê°’

ì •ë°€ë„: ~12mm (PTQ ê¸°ì¤€)
ë²”ìœ„: 0~15m
í‰ê°€: âœ… ê· í˜•ì¡í˜
```

**ì¥ê±°ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°:**
```yaml
max_depth: 30.0  # ì¦ê°€
min_depth: 0.5
integer_weight: 1.0
fractional_weight: 15.0  # ì¦ê°€ í•„ìš”!

ì •ë°€ë„: ~27mm (PTQ ê¸°ì¤€)
ë²”ìœ„: 0~30m
í‰ê°€: âœ… ë²”ìœ„ í™•ëŒ€, ì •ë°€ë„ ì ˆì¶©
```

**ê·¹ì¥ê±°ë¦¬ í•„ìš” (ë¹„ê¶Œì¥):**
```yaml
max_depth: 80.0  # ë§¤ìš° ì¦ê°€
min_depth: 0.5
integer_weight: 1.0
fractional_weight: 30.0+  # í¬ê²Œ ì¦ê°€í•´ë„ íš¨ê³¼ ì œí•œ

ì •ë°€ë„: ~74mm (PTQ ê¸°ì¤€)
ë²”ìœ„: 0~80m
í‰ê°€: âš ï¸ Integer ë„ˆë¬´ ê±°ì¹¨, ê¶Œì¥ ì•ˆí•¨
```

### 7.3 ì¶”ê°€ ê°œì„  ë°©ì•ˆ

Fractional ê°€ì¤‘ì¹˜ ì¦ê°€ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•œ ê²½ìš°:

```python
# 1. Consistency Loss ê°•í™”
consistency_weight: 0.5 â†’ 1.0 ~ 2.0

# 2. ë‹¤ì¤‘ ìŠ¤ì¼€ì¼ í•™ìŠµ
- Scale 0 (ì›ë³¸): ê³ ì •ë°€ë„ ê°ì‹œ
- Scale 1 (1/2): ì¤‘ì •ë°€ë„
- Scale 2 (1/4): ì €ì •ë°€ë„

# 3. í›„ì²˜ë¦¬ í‰í™œí™”
- ì¸ì ‘ í”½ì…€ ì •ë³´ í™œìš©
- ì‹œê°„ì  í‰í™œí™” (ë¹„ë””ì˜¤)
```

---

## ë¶€ë¡: ê³„ì‚° ê³µì‹ ì •ë¦¬

### A.1 í•™ìŠµ ë‹¨ê³„ ë¶„í•´

```python
def decompose_train(depth, max_depth):
    integer_norm = floor(depth) / max_depth  # [0, 1]
    fractional = depth - floor(depth)         # [0, 1]m
    return integer_norm, fractional
```

### A.2 PTQ ì–‘ìí™”

```python
def decompose_ptq(depth, max_depth):
    # Integer: 256 discrete levels
    int_level = round((depth / max_depth) * 255)
    int_level = clamp(int_level, 0, 255)
    
    integer_norm = int_level / 255  # [0, 1]
    integer_depth = integer_norm * max_depth
    
    # Fractional: ë‚˜ë¨¸ì§€
    fractional = depth - integer_depth
    fractional = clamp(fractional, 0, 1)
    
    return integer_norm, fractional
```

### A.3 ì–‘ìí™” ì˜¤ì°¨

```
ì˜¤ì°¨ = integer_depth(quantized) - integer_depth(original)
     â‰¤ max_depth / 255 / 2  (ìµœì•…: ê²½ê³„)
     â‰ˆ max_depth / 510
```

---

## ìµœì¢… ê²°ë¡ 

âœ… **í˜„ì¬ ì„¤ì • (max_depth=15m, fractional_weight=10.0)ì€ ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.**

- ì •ë°€ë„ì™€ ë²”ìœ„ì˜ ê· í˜•
- PTQ ë°°í¬ì— ì í•©
- Fractional ê°€ì¤‘ì¹˜ê°€ ì •ë‹¹í•¨

âš ï¸ **ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš°:**

1. max_depth ë³€ê²½ ì‹œ â†’ Fractional ê°€ì¤‘ì¹˜ë„ í•¨ê»˜ ì¡°ì ˆ
2. ë²”ìœ„ê°€ ì¶©ë¶„í•˜ë©´ â†’ í˜„ì¬ ì„¤ì • ìœ ì§€
3. ë§¤ìš° ë¨¼ ê±°ë¦¬ í•„ìš” â†’ ë‹¤ë¥¸ ì•„í‚¤í…ì²˜ ê³ ë ¤

---

**ë³´ê³ ì„œ ìƒì„± ì¼ì‹œ:** 2025-11-17
**ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸:** `analyze_training_range_effects.py`
**ì‹œê°í™”:** `/workspace/packnet-sfm/outputs/ptq_range_analysis.png`
