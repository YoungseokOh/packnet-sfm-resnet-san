# 1. Introduction

---

## 1.1 Research Background

### 자율주행 및 로보틱스에서의 깊이 추정

Monocular Depth Estimation(단안 깊이 추정)은 단일 RGB 이미지로부터 장면의 3D 깊이 정보를 예측하는 기술로, 자율주행, 로보틱스, AR/VR 등 다양한 분야에서 핵심적인 역할을 수행한다.

```
┌─────────────────────────────────────────────────────────────┐
│                    Application Domains                       │
├─────────────────┬─────────────────┬─────────────────────────┤
│   Autonomous    │    Robotics     │       AR/VR             │
│    Driving      │                 │                         │
├─────────────────┼─────────────────┼─────────────────────────┤
│ • 장애물 감지    │ • 경로 계획     │ • 공간 매핑             │
│ • 차선 인식     │ • 물체 조작     │ • 객체 배치             │
│ • 거리 측정     │ • SLAM          │ • 오클루전 처리         │
└─────────────────┴─────────────────┴─────────────────────────┘
```

### 엣지 디바이스 배포의 필요성

기존 고성능 Depth Estimation 모델들은 GPU 기반의 높은 연산 자원을 요구하지만, 실제 제품 배포 시에는 **Edge Device**에서의 실시간 처리가 필수적이다.

| 플랫폼 | 장점 | 단점 |
|--------|------|------|
| **GPU (Cloud)** | 높은 정확도, 유연성 | 지연시간, 비용, 연결 의존성 |
| **Edge NPU** | 저전력, 실시간, 독립적 | 양자화 오차, 제한된 연산 |

### INT8 양자화의 도전

NPU 배포를 위해 FP32 → INT8 양자화가 필수적이나, 이 과정에서 심각한 정밀도 저하가 발생한다.

```
┌────────────────────────────────────────────────────────────┐
│               Quantization Precision Loss                   │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  FP32 (32-bit)     →    INT8 (8-bit)                       │
│  ────────────────       ────────────                       │
│  • 2^32 표현 범위       • 256 레벨만 표현                   │
│  • 연속적 값            • 이산적 값                        │
│  • 높은 정밀도          • 양자화 오차 발생                  │
│                                                            │
│  Depth Range: 0.5m ~ 15.0m (14.5m 범위)                    │
│  INT8 양자화 간격 = 14.5m / 255 = 56.9mm                   │
│  양자화 오차 = ±28.4mm                                     │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 1.2 Problem Statement

### 핵심 문제

> **"NPU Per-tensor INT8 양자화 환경에서 FP32 수준의 깊이 추정 정확도를 유지하는 방법은?"**

### 기존 접근법의 한계

1. **Advanced Calibration (ST1)**
   - 더 많은 calibration 데이터로 양자화 파라미터 최적화 시도
   - 결과: 100개 → 300개 이미지로 확장해도 **성능 개선 없음**
   - 원인: Per-tensor 양자화의 **구조적 한계**

2. **Post-Training Quantization (PTQ)**
   - 학습 후 양자화 적용
   - 단일 출력 범위가 넓어 양자화 오차 축적

| 방법 | abs_rel | RMSE | 결과 |
|------|---------|------|------|
| FP32 Baseline | 0.0414 | 0.469m | ✅ 기준 |
| PTQ (100 samples) | 0.1133 | 0.741m | ❌ 173% 악화 |
| PTQ (300 samples) | 0.1139 | 0.751m | ❌ 개선 없음 |

---

## 1.3 Our Approach

### 핵심 아이디어: Dual-Head Architecture

**"출력 범위를 분할하여 양자화 정밀도를 극대화"**

```
┌─────────────────────────────────────────────────────────────┐
│              Dual-Head Architecture Concept                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [기존 Single-Head]                                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  Depth Output: [0.5m, 15.0m] → 1개 출력             │   │
│  │  INT8 양자화 간격: 56.9mm → 오차 ±28.4mm            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [제안 Dual-Head]                                           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  Integer Head: [0, 15] → 정수부 (미터 단위)          │   │
│  │  Fractional Head: [0, 1.0m] → 소수부 (서브미터)      │   │
│  │                                                     │   │
│  │  Final Depth = Integer + Fractional                 │   │
│  │  INT8 양자화 간격: 3.92mm → 오차 ±1.96mm            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  🎯 정밀도 향상: 14.5배 (28.4mm → 1.96mm)                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### ResNet18-SAN 개요

본 연구에서는 다음과 같은 아키텍처를 제안한다:

```
┌─────────────────────────────────────────────────────────────┐
│                   ResNet18-SAN Architecture                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   RGB Image ─────┬──────────────────────────────────┐       │
│   [640×384×3]    │                                  │       │
│                  ▼                                  │       │
│          ┌──────────────┐                           │       │
│          │ ResNet18     │                           │       │
│          │ Encoder      │                           │       │
│          └──────┬───────┘                           │       │
│                 │                                   │       │
│                 ▼         Optional                  │       │
│          ┌──────────────┐    ┌────────────┐        │       │
│          │ Skip         │◄───│ Minkowski  │◄── Sparse Depth │
│          │ Features     │    │ Encoder    │    [LiDAR]      │
│          └──────┬───────┘    └────────────┘                 │
│                 │                                           │
│                 ▼                                           │
│          ┌──────────────┐                                   │
│          │ Dual-Head    │                                   │
│          │ Decoder      │                                   │
│          └──────┬───────┘                                   │
│                 │                                           │
│        ┌────────┴────────┐                                  │
│        ▼                 ▼                                  │
│   ┌──────────┐    ┌──────────────┐                         │
│   │ Integer  │    │ Fractional   │                         │
│   │ Head     │    │ Head         │                         │
│   │ [0,15]   │    │ [0,1]m       │                         │
│   └────┬─────┘    └──────┬───────┘                         │
│        │                 │                                  │
│        └────────┬────────┘                                  │
│                 ▼                                           │
│          ┌──────────────┐                                   │
│          │ Final Depth  │                                   │
│          │ = Int + Frac │                                   │
│          └──────────────┘                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 1.4 Contributions

본 연구의 주요 기여점은 다음과 같다:

### 1️⃣ Dual-Head Architecture for INT8 Quantization
- Integer-Fractional 분리 출력 설계
- Per-tensor 양자화 환경에서 14배 정밀도 향상
- NPU Dual-Output 기능 활용 (추가 연산 비용 없음)

### 2️⃣ Lightweight ResNet18-SAN Backbone
- ResNet18 기반 경량 Encoder
- Optional Minkowski Sparse Convolution for LiDAR fusion
- Edge Device 배포에 최적화된 모델 크기

### 3️⃣ Supervised Training Framework
- NCDB (자체 수집 데이터셋) 활용
- LiDAR GT 기반 Supervised Learning
- Scale-Invariant Loss + SILog Loss 결합

### 4️⃣ Comprehensive Evaluation
- FP32 vs INT8 성능 비교
- 다양한 깊이 범위에서의 정밀도 분석
- 실제 NPU 배포 검증

---

## 1.5 Key Results Preview

### 정량적 성과

| Model | abs_rel↓ | RMSE↓ | δ<1.25↑ | 비고 |
|-------|----------|-------|---------|------|
| **FP32 Baseline** | 0.0414 | 0.469m | 0.968 | 기준 |
| INT8 Single-Head | 0.1024 | 0.741m | 0.924 | 147% 악화 |
| **INT8 Dual-Head (목표)** | <0.055 | <0.55m | >0.965 | 32% 개선 예상 |

### 핵심 성과
- ✅ **FP32 성능 달성**: abs_rel 0.0414 (목표 0.065 대비 36% 우수)
- ✅ **경량화**: ResNet18 기반 (ResNet50 대비 60% 파라미터 감소)
- 🔄 **INT8 최적화 진행 중**: Dual-Head로 정밀도 14배 향상 목표

---

## 1.6 Paper Organization

| Section | 내용 |
|---------|------|
| **2. Related Work** | Depth Estimation, SAN, INT8 양자화 관련 연구 |
| **3. Method** | ResNet18-SAN Dual-Head 아키텍처 상세 |
| **4. Experiments** | 데이터셋, 학습 설정, 실험 결과 |
| **5. Future Works** | 향후 연구 방향 및 개선 사항 |
